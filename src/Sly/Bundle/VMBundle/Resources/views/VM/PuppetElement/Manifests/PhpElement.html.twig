{% if vm.phpVersion == '5.4' %}
system::package { "python-software-properties":
    require => Exec['php54 apt update'],
}

exec { "add php54 apt-repo":
    command => "/usr/bin/add-apt-repository ppa:ondrej/php5 -y",
    require => Package["python-software-properties"],
}

exec { "php54 apt update":
    command => "apt-get update",
}
{% endif %}

class { "php":
    source => "/vagrant/files/php/php.ini",
}

file { "php5cli.config":
    path    => "/etc/php5/cli/php.ini",
    ensure  => "/vagrant/files/php/php-cli.ini",
    require => Package["php"],
}

php::module { {{ phpModules }}:
    require => Exec["apt-update"],
    notify  => Service["apache"],
}

{% if apc %}
php::module { "apc":
    module_prefix => "php-",
    require       => Exec["apt-update"],
    notify        => Service["apache"],
}
{% endif %}

{% if vm.phpMyAdmin %}
system::package { "phpmyadmin":
    require => Package["php"]
}
{% endif %}
