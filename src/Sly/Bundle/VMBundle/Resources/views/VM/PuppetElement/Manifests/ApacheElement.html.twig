{% if vm.php %}
class { "apache::mod::php":
    require => Package["php5"]
}
{% else %}
class { "apache": }
{% endif %}

apache::mod { "rewrite": }

apache::vhost { "{{ vm.hostname }}":
    priority      => "50",
    vhost_name    => "*",
    port          => "{{ vm.apachePort }}",
    docroot       => "/var/www/vhosts/{{ vm.hostname }}{{ vm.apacheRootDir }}",
    serveradmin   => "admin@{{ vm.hostname }}",
    serveraliases => [ "webvm" ],
}

{% if vm.php and vm.mysql and vm.phpMyAdmin %}
file { "phpmyadmin-vhost-creation":
    path    => "/etc/apache2/sites-enabled/phpmyadmin.conf",
    ensure  => "/vagrant/files/apache/sites-enabled/phpmyadmin.conf",
    require => [Package["php5"], Package["apache2"]],
    owner   => "root",
    group   => "root",
}
{% endif %}
